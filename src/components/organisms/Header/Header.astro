---
// ============================================
// HEADER COMPONENT
// ============================================
import type { HeaderProps } from './Header.types';
import Logo from "@components/atoms/Logo/Logo.astro";
import Dropdown from "@components/molecules/Nav/Dropdown.astro";
import Anchor from '@components/atoms/Anchor/Anchor.astro';
import { getPublishedArticlesByType, articlesToDropdownItems } from '@/lib/articles';
import defaultImage from "@assets/logo.jpg";

const { transparent = true } = Astro.props as HeaderProps;

// Fetch published articles for each type
const inspirationArticles = await getPublishedArticlesByType('inspiration');
const carnetArticles = await getPublishedArticlesByType('carnet');
const ressourceArticles = await getPublishedArticlesByType('ressource');

// Convert to dropdown items
const inspirationItems = articlesToDropdownItems(inspirationArticles, defaultImage);
const carnetItems = articlesToDropdownItems(carnetArticles, defaultImage);
const ressourcesItems = articlesToDropdownItems(ressourceArticles, defaultImage);
---

<header class="header" class:list={[{ 'header--transparent': transparent }]} data-header>
  <div class="header__container">
    <a href="/" class="header__logo" aria-label="Retour Ã  l'accueil">
      <Logo />
    </a>
    
    <nav class="header__nav" aria-label="Navigation principale">
      <div class="header__nav-dropdowns">
        <Dropdown title="Inspirations" items={inspirationItems} />
        <Dropdown title="Carnets" items={carnetItems} />
        <Dropdown title="Ressources" items={ressourcesItems} />
      </div>
    </nav>
    
    <div class="header__cta">
      <Anchor 
        text="Contactez-nous !" 
        href="/contact" 
        variant="secondary" 
        size="md" 
      />
    </div>
    
    <!-- Mobile menu button -->
    <button 
      class="header__menu-toggle" 
      aria-label="Ouvrir le menu"
      aria-expanded="false"
      data-menu-toggle
    >
      <span class="header__menu-icon"></span>
    </button>
  </div>
  
  <!-- Mobile menu -->
  <div class="header__mobile-menu" data-mobile-menu>
    <nav class="header__mobile-nav" aria-label="Navigation mobile">
      <ul class="header__mobile-list">
        <li><a href="/legendes" class="header__mobile-link">Inspirations</a></li>
        <li><a href="/europe-centrale" class="header__mobile-link">Carnets</a></li>
        <li><a href="/ressources/guide-survie" class="header__mobile-link">Ressources</a></li>
        <li><a href="/contact" class="header__mobile-link header__mobile-link--cta">Contactez-nous !</a></li>
      </ul>
    </nav>
  </div>
</header>

<style lang="scss">
  @use './Header.styles.scss';
</style>

<script>
  import { initHeader } from './Header.script';
  initHeader();
</script>