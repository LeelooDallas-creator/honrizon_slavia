---
// ============================================
// DROPDOWN COMPONENT
// ============================================
import type { DropdownProps } from './Dropdown.types';
import FlipCard from "@components/FlipCard/FlipCard.astro";

const { title, items } = Astro.props as DropdownProps;

// Générer un ID unique pour l'accessibilité
const dropdownId = `dropdown-${title.toLowerCase().replace(/\s+/g, '-')}`;
---

<div class="dropdown" data-dropdown>
  <button
    class="dropdown__trigger"
    aria-expanded="false"
    aria-haspopup="true"
    aria-controls={dropdownId}
    data-dropdown-trigger
  >
    <span class="dropdown__trigger-text">{title}</span>
    <svg 
      class="dropdown__chevron" 
      width="16" 
      height="16" 
      viewBox="0 0 16 16" 
      fill="none"
      aria-hidden="true"
    >
      <path 
        d="M4 6L8 10L12 6" 
        stroke="currentColor" 
        stroke-width="2" 
        stroke-linecap="round" 
        stroke-linejoin="round"
      />
    </svg>
  </button>

  <div
    class="dropdown__panel"
    id={dropdownId}
    role="menu"
    aria-label={`Menu ${title}`}
    data-dropdown-panel
    data-items={items.length}
  >
    <div class="dropdown__inner">
      <div class="dropdown__grid" data-items={items.length}>
        {items.map((item) => (
          <a 
            href={item.href} 
            class="dropdown__item"
            role="menuitem"
            tabindex="-1"
          >
            <h3 class="dropdown__item-title">{item.subtitle}</h3>
            <div class="dropdown__card">
              <FlipCard {...item} />
            </div>
          </a>
        ))}
      </div>
    </div>
  </div>
</div>

<style lang="scss">
  @use './Dropdown.styles.scss';
</style>

<script>
  import { initDropdowns } from './Dropdown.script';
  initDropdowns();
</script>